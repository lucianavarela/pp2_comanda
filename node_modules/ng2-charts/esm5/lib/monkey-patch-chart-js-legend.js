/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
// tslint:disable:variable-name
// tslint:disable:no-var-keyword
// tslint:disable:prefer-const
// tslint:disable:only-arrow-functions
// tslint:disable:one-variable-per-declaration
// tslint:disable:object-literal-shorthand
// tslint:disable:space-before-function-paren
/** @type {?} */
var helpers = Chart.helpers;
/** @type {?} */
var defaults = Chart.defaults;
/** @type {?} */
var valueOrDefault = helpers.valueOrDefault;
/**
 * @param {?} labelOpts
 * @param {?} fontSize
 * @return {?}
 */
function getBoxWidth(labelOpts, fontSize) {
    return labelOpts.usePointStyle && labelOpts.boxWidth > fontSize ?
        fontSize :
        labelOpts.boxWidth;
}
/**
 * @return {?}
 */
function fit() {
    /** @type {?} */
    var me = this;
    /** @type {?} */
    var opts = me.options;
    /** @type {?} */
    var labelOpts = opts.labels;
    /** @type {?} */
    var display = opts.display;
    /** @type {?} */
    var ctx = me.ctx;
    /** @type {?} */
    var labelFont = helpers.options._parseFont(labelOpts);
    /** @type {?} */
    var fontSize = labelFont.size;
    // Reset hit boxes
    /** @type {?} */
    var hitboxes = me.legendHitBoxes = [];
    /** @type {?} */
    var minSize = me.minSize;
    /** @type {?} */
    var isHorizontal = me.isHorizontal();
    if (isHorizontal) {
        minSize.width = me.maxWidth; // fill all the width
        minSize.height = display ? 10 : 0;
    }
    else {
        minSize.width = display ? 10 : 0;
        minSize.height = me.maxHeight; // fill all the height
    }
    /** @type {?} */
    var getMaxLineWidth = (/**
     * @param {?} textLines
     * @return {?}
     */
    function (textLines) {
        return textLines.map((/**
         * @param {?} textLine
         * @return {?}
         */
        function (textLine) {
            return ctx.measureText(textLine).width;
        })).reduce((/**
         * @param {?} acc
         * @param {?} v
         * @return {?}
         */
        function (acc, v) {
            return v > acc ? v : acc;
        }), 0);
    });
    // Increase sizes here
    if (display) {
        ctx.font = labelFont.string;
        if (isHorizontal) {
            // Labels
            // Width of each line of legend boxes. Labels wrap onto multiple lines when there are too many to fit on one
            /** @type {?} */
            var lineWidths = me.lineWidths = [0];
            /** @type {?} */
            var lineHeights = me.lineHeights = [];
            /** @type {?} */
            var currentLineHeight = 0;
            /** @type {?} */
            var lineIndex = 0;
            ctx.textAlign = 'left';
            ctx.textBaseline = 'top';
            helpers.each(me.legendItems, (/**
             * @param {?} legendItem
             * @param {?} i
             * @return {?}
             */
            function (legendItem, i) {
                /** @type {?} */
                var width;
                /** @type {?} */
                var height;
                if (helpers.isArray(legendItem.text)) {
                    width = getMaxLineWidth(legendItem.text);
                    height = fontSize * legendItem.text.length + labelOpts.padding;
                }
                else {
                    width = ctx.measureText(legendItem.text).width;
                    height = fontSize + labelOpts.padding;
                }
                width += getBoxWidth(labelOpts, fontSize) + (fontSize / 2);
                if (lineWidths[lineWidths.length - 1] + width + 2 * labelOpts.padding > minSize.width) {
                    lineHeights.push(currentLineHeight);
                    currentLineHeight = 0;
                    lineWidths[lineWidths.length - (i > 0 ? 0 : 1)] = 0;
                    lineIndex++;
                }
                legendItem.lineOrColumnIndex = lineIndex;
                if (height > currentLineHeight) {
                    currentLineHeight = height;
                }
                // Store the hitbox width and height here. Final position will be updated in `draw`
                hitboxes[i] = {
                    left: 0,
                    top: 0,
                    width: width,
                    height: height,
                };
                lineWidths[lineWidths.length - 1] += width + labelOpts.padding;
            }));
            lineHeights.push(currentLineHeight);
            minSize.height += lineHeights.reduce((/**
             * @param {?} acc
             * @param {?} v
             * @return {?}
             */
            function (acc, v) {
                return acc + v;
            }), 0);
        }
        else {
            /** @type {?} */
            var vPadding = labelOpts.padding;
            /** @type {?} */
            var columnWidths = me.columnWidths = [];
            /** @type {?} */
            var columnHeights = me.columnHeights = [];
            /** @type {?} */
            var totalWidth = labelOpts.padding;
            /** @type {?} */
            var currentColWidth = 0;
            /** @type {?} */
            var currentColHeight = 0;
            /** @type {?} */
            var columnIndex = 0;
            helpers.each(me.legendItems, (/**
             * @param {?} legendItem
             * @param {?} i
             * @return {?}
             */
            function (legendItem, i) {
                /** @type {?} */
                var itemWidth;
                /** @type {?} */
                var height;
                if (helpers.isArray(legendItem.text)) {
                    itemWidth = getMaxLineWidth(legendItem.text);
                    height = fontSize * legendItem.text.length;
                }
                else {
                    itemWidth = ctx.measureText(legendItem.text).width;
                    height = fontSize;
                }
                itemWidth += getBoxWidth(labelOpts, fontSize) + (fontSize / 2);
                // If too tall, go to new column
                if (currentColHeight + fontSize + 2 * vPadding > minSize.height) {
                    totalWidth += currentColWidth + labelOpts.padding;
                    columnWidths.push(currentColWidth); // previous column width
                    columnHeights.push(currentColHeight);
                    currentColWidth = 0;
                    currentColHeight = 0;
                    columnIndex++;
                }
                legendItem.lineOrColumnIndex = columnIndex;
                // Get max width
                currentColWidth = Math.max(currentColWidth, itemWidth);
                currentColHeight += height + vPadding;
                // Store the hitbox width and height here. Final position will be updated in `draw`
                hitboxes[i] = {
                    left: 0,
                    top: 0,
                    width: itemWidth,
                    height: height
                };
            }));
            totalWidth += currentColWidth;
            columnWidths.push(currentColWidth);
            columnHeights.push(currentColHeight);
            minSize.width += totalWidth;
        }
    }
    me.width = minSize.width;
    me.height = minSize.height;
}
/**
 * @return {?}
 */
function draw() {
    /** @type {?} */
    var me = this;
    /** @type {?} */
    var opts = me.options;
    /** @type {?} */
    var labelOpts = opts.labels;
    /** @type {?} */
    var globalDefaults = defaults.global;
    /** @type {?} */
    var defaultColor = globalDefaults.defaultColor;
    /** @type {?} */
    var lineDefault = globalDefaults.elements.line;
    /** @type {?} */
    var legendHeight = me.height;
    /** @type {?} */
    var columnHeights = me.columnHeights;
    /** @type {?} */
    var columnWidths = me.columnWidths;
    /** @type {?} */
    var legendWidth = me.width;
    /** @type {?} */
    var lineWidths = me.lineWidths;
    /** @type {?} */
    var lineHeights = me.lineHeights;
    if (opts.display) {
        /** @type {?} */
        var ctx = me.ctx;
        /** @type {?} */
        var fontColor = valueOrDefault(labelOpts.fontColor, globalDefaults.defaultFontColor);
        /** @type {?} */
        var labelFont = helpers.options._parseFont(labelOpts);
        /** @type {?} */
        var fontSize = labelFont.size;
        /** @type {?} */
        var cursor;
        // Canvas setup
        ctx.textAlign = 'left';
        ctx.textBaseline = 'middle';
        ctx.lineWidth = 0.5;
        ctx.strokeStyle = fontColor; // for strikethrough effect
        ctx.fillStyle = fontColor; // render in correct colour
        ctx.font = labelFont.string;
        /** @type {?} */
        var boxWidth = getBoxWidth(labelOpts, fontSize);
        /** @type {?} */
        var hitboxes = me.legendHitBoxes;
        // current position
        /** @type {?} */
        var drawLegendBox = (/**
         * @param {?} x
         * @param {?} y
         * @param {?} legendItem
         * @return {?}
         */
        function (x, y, legendItem) {
            if (isNaN(boxWidth) || boxWidth <= 0) {
                return;
            }
            // Set the ctx for the box
            ctx.save();
            /** @type {?} */
            var lineWidth = valueOrDefault(legendItem.lineWidth, lineDefault.borderWidth);
            ctx.fillStyle = valueOrDefault(legendItem.fillStyle, defaultColor);
            ctx.lineCap = valueOrDefault(legendItem.lineCap, lineDefault.borderCapStyle);
            ctx.lineDashOffset = valueOrDefault(legendItem.lineDashOffset, lineDefault.borderDashOffset);
            ctx.lineJoin = valueOrDefault(legendItem.lineJoin, lineDefault.borderJoinStyle);
            ctx.lineWidth = lineWidth;
            ctx.strokeStyle = valueOrDefault(legendItem.strokeStyle, defaultColor);
            if (ctx.setLineDash) {
                // IE 9 and 10 do not support line dash
                ctx.setLineDash(valueOrDefault(legendItem.lineDash, lineDefault.borderDash));
            }
            if (opts.labels && opts.labels.usePointStyle) {
                // Recalculate x and y for drawPoint() because its expecting
                // x and y to be center of figure (instead of top left)
                /** @type {?} */
                var radius = boxWidth * Math.SQRT2 / 2;
                /** @type {?} */
                var centerX = x + boxWidth / 2;
                /** @type {?} */
                var centerY = y + fontSize / 2;
                // Draw pointStyle as legend symbol
                helpers.canvas.drawPoint(ctx, legendItem.pointStyle, radius, centerX, centerY);
            }
            else {
                // Draw box as legend symbol
                if (lineWidth !== 0) {
                    ctx.strokeRect(x, y, boxWidth, fontSize);
                }
                ctx.fillRect(x, y, boxWidth, fontSize);
            }
            ctx.restore();
        });
        /** @type {?} */
        var drawStrikeThrough = (/**
         * @param {?} x
         * @param {?} y
         * @param {?} w
         * @return {?}
         */
        function (x, y, w) {
            ctx.beginPath();
            ctx.lineWidth = 2;
            ctx.moveTo(x, y);
            ctx.lineTo(x + w, y);
            ctx.stroke();
        });
        /** @type {?} */
        var drawCrossOver = (/**
         * @param {?} x
         * @param {?} y
         * @param {?} w
         * @param {?} h
         * @return {?}
         */
        function (x, y, w, h) {
            ctx.beginPath();
            ctx.lineWidth = 2;
            ctx.moveTo(x, y);
            ctx.lineTo(x + w, y + h);
            ctx.moveTo(x, y + h);
            ctx.lineTo(x + w, y);
            ctx.stroke();
        });
        /** @type {?} */
        var fillText = (/**
         * @param {?} x
         * @param {?} y
         * @param {?} legendItem
         * @param {?} textWidth
         * @return {?}
         */
        function (x, y, legendItem, textWidth) {
            /** @type {?} */
            var halfFontSize = fontSize / 2;
            /** @type {?} */
            var xLeft = boxWidth + halfFontSize + x;
            /** @type {?} */
            var yMiddle = y + halfFontSize;
            if (helpers.isArray(legendItem.text)) {
                helpers.each(legendItem.text, (/**
                 * @param {?} textLine
                 * @param {?} index
                 * @return {?}
                 */
                function (textLine, index) {
                    /** @type {?} */
                    var lineOffset = index * fontSize;
                    ctx.fillText(textLine, xLeft, yMiddle + lineOffset);
                }));
            }
            else {
                ctx.fillText(legendItem.text, xLeft, yMiddle);
            }
            if (legendItem.hidden) {
                if (helpers.isArray(legendItem.text)) {
                    drawCrossOver(xLeft, yMiddle, textWidth, (legendItem.text.length - 1) * (fontSize - 1));
                }
                else {
                    drawStrikeThrough(xLeft, yMiddle, textWidth);
                }
            }
        });
        /** @type {?} */
        var alignmentOffset = (/**
         * @param {?} dimension
         * @param {?} blockSize
         * @return {?}
         */
        function (dimension, blockSize) {
            switch (opts.align) {
                case 'start':
                    return labelOpts.padding;
                case 'end':
                    return dimension - blockSize;
                default: // center
                    return (dimension - blockSize + labelOpts.padding) / 2;
            }
        });
        // Horizontal
        /** @type {?} */
        var isHorizontal = me.isHorizontal();
        if (isHorizontal) {
            cursor = {
                x: me.left + alignmentOffset(legendWidth, lineWidths[0]),
                y: me.top + labelOpts.padding,
                line: 0
            };
        }
        else {
            cursor = {
                x: me.left + labelOpts.padding,
                y: me.top + alignmentOffset(legendHeight, columnHeights[0]),
                line: 0
            };
        }
        helpers.each(me.legendItems, (/**
         * @param {?} legendItem
         * @param {?} i
         * @return {?}
         */
        function (legendItem, i) {
            /** @type {?} */
            var textWidth;
            /** @type {?} */
            var height;
            /** @type {?} */
            var boxTopOffset;
            if (legendItem.lineOrColumnIndex > cursor.line) {
                if (isHorizontal) {
                    cursor.y += lineHeights[cursor.line];
                    cursor.line = legendItem.lineOrColumnIndex;
                    cursor.x = me.left + alignmentOffset(legendWidth, lineWidths[cursor.line]);
                }
                else {
                    cursor.x += columnWidths[cursor.line] + labelOpts.padding;
                    cursor.line = legendItem.lineOrColumnIndex;
                    cursor.y = me.top + alignmentOffset(legendHeight, columnHeights[cursor.line]);
                }
            }
            if (helpers.isArray(legendItem.text)) {
                textWidth = legendItem.text.map((/**
                 * @param {?} textLine
                 * @return {?}
                 */
                function (textLine) {
                    return ctx.measureText(textLine).width;
                })).reduce((/**
                 * @param {?} acc
                 * @param {?} v
                 * @return {?}
                 */
                function (acc, v) {
                    return v > acc ? v : acc;
                }), 0);
                boxTopOffset = fontSize / 2 * (legendItem.text.length - 1);
                height = fontSize * legendItem.text.length;
            }
            else {
                textWidth = ctx.measureText(legendItem.text).width;
                boxTopOffset = 0;
                height = fontSize;
            }
            /** @type {?} */
            var width = boxWidth + (fontSize / 2) + textWidth;
            /** @type {?} */
            var x = cursor.x;
            /** @type {?} */
            var y = cursor.y;
            /** @type {?} */
            var topOffset = isHorizontal ? Math.trunc((lineHeights[cursor.line] - hitboxes[i].height) / 2) : 0;
            drawLegendBox(x, y + boxTopOffset + topOffset, legendItem);
            hitboxes[i].left = x;
            hitboxes[i].top = y;
            // Fill the actual label
            fillText(x, y + topOffset, legendItem, textWidth);
            if (isHorizontal) {
                cursor.x += width + labelOpts.padding;
            }
            else {
                cursor.y += height + labelOpts.padding;
            }
        }));
    }
}
/**
 * @return {?}
 */
export function monkeyPatchChartJsLegend() {
    /** @type {?} */
    var plugins = Chart.plugins.getAll();
    /** @type {?} */
    var legend = plugins.filter((/**
     * @param {?} p
     * @return {?}
     */
    function (p) { return p.id === 'legend'; }))[0];
    legend._element.prototype.fit = fit;
    legend._element.prototype.draw = draw;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9ua2V5LXBhdGNoLWNoYXJ0LWpzLWxlZ2VuZC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25nMi1jaGFydHMvIiwic291cmNlcyI6WyJsaWIvbW9ua2V5LXBhdGNoLWNoYXJ0LWpzLWxlZ2VuZC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7SUFnQk0sT0FBTyxHQUFHLEtBQUssQ0FBQyxPQUFPOztJQUN2QixRQUFRLEdBQUcsS0FBSyxDQUFDLFFBQVE7O0lBQ3pCLGNBQWMsR0FBRyxPQUFPLENBQUMsY0FBYzs7Ozs7O0FBRTdDLFNBQVMsV0FBVyxDQUFDLFNBQVMsRUFBRSxRQUFRO0lBQ3RDLE9BQU8sU0FBUyxDQUFDLGFBQWEsSUFBSSxTQUFTLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQyxDQUFDO1FBQy9ELFFBQVEsQ0FBQyxDQUFDO1FBQ1YsU0FBUyxDQUFDLFFBQVEsQ0FBQztBQUN2QixDQUFDOzs7O0FBRUQsU0FBUyxHQUFHOztRQUNOLEVBQUUsR0FBRyxJQUFJOztRQUNULElBQUksR0FBRyxFQUFFLENBQUMsT0FBTzs7UUFDakIsU0FBUyxHQUFHLElBQUksQ0FBQyxNQUFNOztRQUN2QixPQUFPLEdBQUcsSUFBSSxDQUFDLE9BQU87O1FBRXRCLEdBQUcsR0FBRyxFQUFFLENBQUMsR0FBRzs7UUFFWixTQUFTLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDOztRQUNqRCxRQUFRLEdBQUcsU0FBUyxDQUFDLElBQUk7OztRQUd6QixRQUFRLEdBQUcsRUFBRSxDQUFDLGNBQWMsR0FBRyxFQUFFOztRQUVqQyxPQUFPLEdBQUcsRUFBRSxDQUFDLE9BQU87O1FBQ3BCLFlBQVksR0FBRyxFQUFFLENBQUMsWUFBWSxFQUFFO0lBRXBDLElBQUksWUFBWSxFQUFFO1FBQ2hCLE9BQU8sQ0FBQyxLQUFLLEdBQUcsRUFBRSxDQUFDLFFBQVEsQ0FBQyxDQUFDLHFCQUFxQjtRQUNsRCxPQUFPLENBQUMsTUFBTSxHQUFH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Q0FBQyxDQUFDLENBQUM7WUFFbEcsYUFBYSxDQUFDLENBQUMsRUFBRSxDQUFDLEdBQUcsWUFBWSxHQUFHLFNBQVMsRUFBRSxVQUFVLENBQUMsQ0FBQztZQUUzRCxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxHQUFHLENBQUMsQ0FBQztZQUNyQixRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQztZQUVwQix3QkFBd0I7WUFDeEIsUUFBUSxDQUFDLENBQUMsRUFBRSxDQUFDLEdBQUcsU0FBUyxFQUFFLFVBQVUsRUFBRSxTQUFTLENBQUMsQ0FBQztZQUVsRCxJQUFJLFlBQVksRUFBRTtnQkFDaEIsTUFBTSxDQUFDLENBQUMsSUFBSSxLQUFLLEdBQUcsU0FBUyxDQUFDLE9BQU8sQ0FBQzthQUN2QztpQkFBTTtnQkFDTCxNQUFNLENBQUMsQ0FBQyxJQUFJLE1BQU0sR0FBRyxTQUFTLENBQUMsT0FBTyxDQUFDO2FBQ3hDO1FBQ0gsQ0FBQyxFQUFDLENBQUM7S0FDSjtBQUNILENBQUM7Ozs7QUFFRCxNQUFNLFVBQVUsd0JBQXdCOztRQUNoQyxPQUFPLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUU7O1FBQ2hDLE1BQU0sR0FBRyxPQUFPLENBQUMsTUFBTTs7OztJQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLEVBQUUsS0FBSyxRQUFRLEVBQWpCLENBQWlCLEVBQUMsQ0FBQyxDQUFDLENBQUM7SUFDeEQsTUFBTSxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQztJQUNwQyxNQUFNLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO0FBQ3hDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyB0c2xpbnQ6ZGlzYWJsZTp2YXJpYWJsZS1uYW1lXHJcbi8vIHRzbGludDpkaXNhYmxlOm5vLXZhci1rZXl3b3JkXHJcbi8vIHRzbGludDpkaXNhYmxlOnByZWZlci1jb25zdFxyXG4vLyB0c2xpbnQ6ZGlzYWJsZTpvbmx5LWFycm93LWZ1bmN0aW9uc1xyXG4vLyB0c2xpbnQ6ZGlzYWJsZTpvbmUtdmFyaWFibGUtcGVyLWRlY2xhcmF0aW9uXHJcbi8vIHRzbGludDpkaXNhYmxlOm9iamVjdC1saXRlcmFsLXNob3J0aGFuZFxyXG4vLyB0c2xpbnQ6ZGlzYWJsZTpzcGFjZS1iZWZvcmUtZnVuY3Rpb24tcGFyZW5cclxuXHJcbmRlY2xhcmUgY2xhc3MgQ2hhcnQge1xyXG4gIHN0YXRpYyByZWFkb25seSBDaGFydDogdHlwZW9mIENoYXJ0O1xyXG4gIHN0YXRpYyByZWFkb25seSBUb29sdGlwOiBhbnk7XHJcbiAgc3RhdGljIHJlYWRvbmx5IGhlbHBlcnM6IGFueTtcclxuICBzdGF0aWMgcmVhZG9ubHkgZGVmYXVsdHM6IGFueTtcclxuICBzdGF0aWMgcmVhZG9ubHkgcGx1Z2luczogYW55O1xyXG59XHJcblxyXG5jb25zdCBoZWxwZXJzID0gQ2hhcnQuaGVscGVycztcclxuY29uc3QgZGVmYXVsdHMgPSBDaGFydC5kZWZhdWx0cztcclxuY29uc3QgdmFsdWVPckRlZmF1bHQgPSBoZWxwZXJzLnZhbHVlT3JEZWZhdWx0O1xyXG5cclxuZnVuY3Rpb24gZ2V0Qm94V2lkdGgobGFiZWxPcHRzLCBmb250U2l6ZSkge1xyXG4gIHJldHVybiBsYWJlbE9wdHMudXNlUG9pbnRTdHlsZSAmJiBsYWJlbE9wdHMuYm94V2lkdGggPiBmb250U2l6ZSA/XHJcbiAgICBmb250U2l6ZSA6XHJcbiAgICBsYWJlbE9wdHMuYm94V2lkdGg7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGZpdCgpIHtcclxuICB2YXIgbWUgPSB0aGlzO1xyXG4gIHZhciBvcHRzID0gbWUub3B0aW9ucztcclxuICB2YXIgbGFiZWxPcHRzID0gb3B0cy5sYWJlbHM7XHJcbiAgdmFyIGRpc3BsYXkgPSBvcHRzLmRpc3BsYXk7XHJcblxyXG4gIHZhciBjdHggPSBtZS5jdHg7XHJcblxyXG4gIHZhciBsYWJlbEZvbnQgPSBoZWxwZXJzLm9wdGlvbnMuX3BhcnNlRm9udChsYWJlbE9wdHMpO1xyXG4gIHZhciBmb250U2l6ZSA9IGxhYmVsRm9udC5zaXplO1xyXG5cclxuICAvLyBSZXNldCBoaXQgYm94ZXNcclxuICB2YXIgaGl0Ym94ZXMgPSBtZS5sZWdlbmRIaXRCb3hlcyA9IFtdO1xyXG5cclxuICB2YXIgbWluU2l6ZSA9IG1lLm1pblNpemU7XHJcbiAgdmFyIGlzSG9yaXpvbnRhbCA9IG1lLmlzSG9yaXpvbnRhbCgpO1xyXG5cclxuICBpZiAoaXNIb3Jpem9udGFsKSB7XHJcbiAgICBtaW5TaXplLndpZHRoID0gbWUubWF4V2lkdGg7IC8vIGZpbGwgYWxsIHRoZSB3aWR0aFxyXG4gICAgbWluU2l6ZS5oZWlnaHQgPSBkaXNwbGF5ID8gMTAgOiAwO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBtaW5TaXplLndpZHRoID0gZGlzcGxheSA/IDEwIDogMDtcclxuICAgIG1pblNpemUuaGVpZ2h0ID0gbWUubWF4SGVpZ2h0OyAvLyBmaWxsIGFsbCB0aGUgaGVpZ2h0XHJcbiAgfVxyXG5cclxuICB2YXIgZ2V0TWF4TGluZVdpZHRoID0gZnVuY3Rpb24gKHRleHRMaW5lcykge1xyXG4gICAgcmV0dXJuIHRleHRMaW5lcy5tYXAoZnVuY3Rpb24gKHRleHRMaW5lKSB7XHJcbiAgICAgIHJldHVybiBjdHgubWVhc3VyZVRleHQodGV4dExpbmUpLndpZHRoO1xyXG4gICAgfSkucmVkdWNlKGZ1bmN0aW9uIChhY2MsIHYpIHtcclxuICAgICAgcmV0dXJuIHYgPiBhY2MgPyB2IDogYWNjO1xyXG4gICAgfSwgMCk7XHJcbiAgfTtcclxuXHJcbiAgLy8gSW5jcmVhc2Ugc2l6ZXMgaGVyZVxyXG4gIGlmIChkaXNwbGF5KSB7XHJcbiAgICBjdHguZm9udCA9IGxhYmVsRm9udC5zdHJpbmc7XHJcblxyXG4gICAgaWYgKGlzSG9yaXpvbnRhbCkge1xyXG5cclxuICAgICAgLy8gTGFiZWxzXHJcblxyXG4gICAgICAvLyBXaWR0aCBvZiBlYWNoIGxpbmUgb2YgbGVnZW5kIGJveGVzLiBMYWJlbHMgd3JhcCBvbnRvIG11bHRpcGxlIGxpbmVzIHdoZW4gdGhlcmUgYXJlIHRvbyBtYW55IHRvIGZpdCBvbiBvbmVcclxuICAgICAgdmFyIGxpbmVXaWR0aHMgPSBtZS5saW5lV2lkdGhzID0gWzBdO1xyXG4gICAgICB2YXIgbGluZUhlaWdodHMgPSBtZS5saW5lSGVpZ2h0cyA9IFtdO1xyXG4gICAgICB2YXIgY3VycmVudExpbmVIZWlnaHQgPSAwO1xyXG4gICAgICB2YXIgbGluZUluZGV4ID0gMDtcclxuXHJcbiAgICAgIGN0eC50ZXh0QWxpZ24gPSAnbGVmdCc7XHJcbiAgICAgIGN0eC50ZXh0QmFzZWxpbmUgPSAndG9wJztcclxuXHJcbiAgICAgIGhlbHBlcnMuZWFjaChtZS5sZWdlbmRJdGVtcywgZnVuY3Rpb24gKGxlZ2VuZEl0ZW0sIGkpIHtcclxuICAgICAgICB2YXIgd2lkdGgsIGhlaWdodDtcclxuXHJcbiAgICAgICAgaWYgKGhlbHBlcnMuaXNBcnJheShsZWdlbmRJdGVtLnRleHQpKSB7XHJcbiAgICAgICAgICB3aWR0aCA9IGdldE1heExpbmVXaWR0aChsZWdlbmRJdGVtLnRleHQpO1xyXG4gICAgICAgICAgaGVpZ2h0ID0gZm9udFNpemUgKiBsZWdlbmRJdGVtLnRleHQubGVuZ3RoICsgbGFiZWxPcHRzLnBhZGRpbmc7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHdpZHRoID0gY3R4Lm1lYXN1cmVUZXh0KGxlZ2VuZEl0ZW0udGV4dCkud2lkdGg7XHJcbiAgICAgICAgICBoZWlnaHQgPSBmb250U2l6ZSArIGxhYmVsT3B0cy5wYWRkaW5nO1xyXG4gICAgICAgIH1cclxuICAgICAgICB3aWR0aCArPSBnZXRCb3hXaWR0aChsYWJlbE9wdHMsIGZvbnRTaXplKSArIChmb250U2l6ZSAvIDIpO1xyXG5cclxuICAgICAgICBpZiAobGluZVdpZHRoc1tsaW5lV2lkdGhzLmxlbmd0aCAtIDFdICsgd2lkdGggKyAyICogbGFiZWxPcHRzLnBhZGRpbmcgPiBtaW5TaXplLndpZHRoKSB7XHJcbiAgICAgICAgICBsaW5lSGVpZ2h0cy5wdXNoKGN1cnJlbnRMaW5lSGVpZ2h0KTtcclxuICAgICAgICAgIGN1cnJlbnRMaW5lSGVpZ2h0ID0gMDtcclxuICAgICAgICAgIGxpbmVXaWR0aHNbbGluZVdpZHRocy5sZW5ndGggLSAoaSA+IDAgPyAwIDogMSldID0gMDtcclxuICAgICAgICAgIGxpbmVJbmRleCsrO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGVnZW5kSXRlbS5saW5lT3JDb2x1bW5JbmRleCA9IGxpbmVJbmRleDtcclxuXHJcbiAgICAgICAgaWYgKGhlaWdodCA+IGN1cnJlbnRMaW5lSGVpZ2h0KSB7XHJcbiAgICAgICAgICBjdXJyZW50TGluZUhlaWdodCA9IGhlaWdodDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFN0b3JlIHRoZSBoaXRib3ggd2lkdGggYW5kIGhlaWdodCBoZXJlLiBGaW5hbCBwb3NpdGlvbiB3aWxsIGJlIHVwZGF0ZWQgaW4gYGRyYXdgXHJcbiAgICAgICAgaGl0Ym94ZXNbaV0gPSB7XHJcbiAgICAgICAgICBsZWZ0OiAwLFxyXG4gICAgICAgICAgdG9wOiAwLFxyXG4gICAgICAgICAgd2lkdGg6IHdpZHRoLFxyXG4gICAgICAgICAgaGVpZ2h0OiBoZWlnaHQsXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgbGluZVdpZHRoc1tsaW5lV2lkdGhzLmxlbmd0aCAtIDFdICs9IHdpZHRoICsgbGFiZWxPcHRzLnBhZGRpbmc7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgbGluZUhlaWdodHMucHVzaChjdXJyZW50TGluZUhlaWdodCk7XHJcbiAgICAgIG1pblNpemUuaGVpZ2h0ICs9IGxpbmVIZWlnaHRzLnJlZHVjZShmdW5jdGlvbiAoYWNjLCB2KSB7XHJcbiAgICAgICAgcmV0dXJuIGFjYyArIHY7XHJcbiAgICAgIH0sIDApO1xyXG5cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHZhciB2UGFkZGluZyA9IGxhYmVsT3B0cy5wYWRkaW5nO1xyXG4gICAgICB2YXIgY29sdW1uV2lkdGhzID0gbWUuY29sdW1uV2lkdGhzID0gW107XHJcbiAgICAgIHZhciBjb2x1bW5IZWlnaHRzID0gbWUuY29sdW1uSGVpZ2h0cyA9IFtdO1xyXG4gICAgICB2YXIgdG90YWxXaWR0aCA9IGxhYmVsT3B0cy5wYWRkaW5nO1xyXG4gICAgICB2YXIgY3VycmVudENvbFdpZHRoID0gMDtcclxuICAgICAgdmFyIGN1cnJlbnRDb2xIZWlnaHQgPSAwO1xyXG4gICAgICB2YXIgY29sdW1uSW5kZXggPSAwO1xyXG5cclxuICAgICAgaGVscGVycy5lYWNoKG1lLmxlZ2VuZEl0ZW1zLCBmdW5jdGlvbiAobGVnZW5kSXRlbSwgaSkge1xyXG4gICAgICAgIHZhciBpdGVtV2lkdGg7XHJcbiAgICAgICAgdmFyIGhlaWdodDtcclxuXHJcbiAgICAgICAgaWYgKGhlbHBlcnMuaXNBcnJheShsZWdlbmRJdGVtLnRleHQpKSB7XHJcbiAgICAgICAgICBpdGVtV2lkdGggPSBnZXRNYXhMaW5lV2lkdGgobGVnZW5kSXRlbS50ZXh0KTtcclxuICAgICAgICAgIGhlaWdodCA9IGZvbnRTaXplICogbGVnZW5kSXRlbS50ZXh0Lmxlbmd0aDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgaXRlbVdpZHRoID0gY3R4Lm1lYXN1cmVUZXh0KGxlZ2VuZEl0ZW0udGV4dCkud2lkdGg7XHJcbiAgICAgICAgICBoZWlnaHQgPSBmb250U2l6ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaXRlbVdpZHRoICs9IGdldEJveFdpZHRoKGxhYmVsT3B0cywgZm9udFNpemUpICsgKGZvbnRTaXplIC8gMik7XHJcblxyXG4gICAgICAgIC8vIElmIHRvbyB0YWxsLCBnbyB0byBuZXcgY29sdW1uXHJcbiAgICAgICAgaWYgKGN1cnJlbnRDb2xIZWlnaHQgKyBmb250U2l6ZSArIDIgKiB2UGFkZGluZyA+IG1pblNpemUuaGVpZ2h0KSB7XHJcbiAgICAgICAgICB0b3RhbFdpZHRoICs9IGN1cnJlbnRDb2xXaWR0aCArIGxhYmVsT3B0cy5wYWRkaW5nO1xyXG4gICAgICAgICAgY29sdW1uV2lkdGhzLnB1c2goY3VycmVudENvbFdpZHRoKTsgLy8gcHJldmlvdXMgY29sdW1uIHdpZHRoXHJcbiAgICAgICAgICBjb2x1bW5IZWlnaHRzLnB1c2goY3VycmVudENvbEhlaWdodCk7XHJcbiAgICAgICAgICBjdXJyZW50Q29sV2lkdGggPSAwO1xyXG4gICAgICAgICAgY3VycmVudENvbEhlaWdodCA9IDA7XHJcbiAgICAgICAgICBjb2x1bW5JbmRleCsrO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGVnZW5kSXRlbS5saW5lT3JDb2x1bW5JbmRleCA9IGNvbHVtbkluZGV4O1xyXG5cclxuICAgICAgICAvLyBHZXQgbWF4IHdpZHRoXHJcbiAgICAgICAgY3VycmVudENvbFdpZHRoID0gTWF0aC5tYXgoY3VycmVudENvbFdpZHRoLCBpdGVtV2lkdGgpO1xyXG4gICAgICAgIGN1cnJlbnRDb2xIZWlnaHQgKz0gaGVpZ2h0ICsgdlBhZGRpbmc7XHJcblxyXG4gICAgICAgIC8vIFN0b3JlIHRoZSBoaXRib3ggd2lkdGggYW5kIGhlaWdodCBoZXJlLiBGaW5hbCBwb3NpdGlvbiB3aWxsIGJlIHVwZGF0ZWQgaW4gYGRyYXdgXHJcbiAgICAgICAgaGl0Ym94ZXNbaV0gPSB7XHJcbiAgICAgICAgICBsZWZ0OiAwLFxyXG4gICAgICAgICAgdG9wOiAwLFxyXG4gICAgICAgICAgd2lkdGg6IGl0ZW1XaWR0aCxcclxuICAgICAgICAgIGhlaWdodDogaGVpZ2h0XHJcbiAgICAgICAgfTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICB0b3RhbFdpZHRoICs9IGN1cnJlbnRDb2xXaWR0aDtcclxuICAgICAgY29sdW1uV2lkdGhzLnB1c2goY3VycmVudENvbFdpZHRoKTtcclxuICAgICAgY29sdW1uSGVpZ2h0cy5wdXNoKGN1cnJlbnRDb2xIZWlnaHQpO1xyXG4gICAgICBtaW5TaXplLndpZHRoICs9IHRvdGFsV2lkdGg7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBtZS53aWR0aCA9IG1pblNpemUud2lkdGg7XHJcbiAgbWUuaGVpZ2h0ID0gbWluU2l6ZS5oZWlnaHQ7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGRyYXcoKSB7XHJcbiAgdmFyIG1lID0gdGhpcztcclxuICB2YXIgb3B0cyA9IG1lLm9wdGlvbnM7XHJcbiAgdmFyIGxhYmVsT3B0cyA9IG9wdHMubGFiZWxzO1xyXG4gIHZhciBnbG9iYWxEZWZhdWx0cyA9IGRlZmF1bHRzLmdsb2JhbDtcclxuICB2YXIgZGVmYXVsdENvbG9yID0gZ2xvYmFsRGVmYXVsdHMuZGVmYXVsdENvbG9yO1xyXG4gIHZhciBsaW5lRGVmYXVsdCA9IGdsb2JhbERlZmF1bHRzLmVsZW1lbnRzLmxpbmU7XHJcbiAgdmFyIGxlZ2VuZEhlaWdodCA9IG1lLmhlaWdodDtcclxuICB2YXIgY29sdW1uSGVpZ2h0cyA9IG1lLmNvbHVtbkhlaWdodHM7XHJcbiAgdmFyIGNvbHVtbldpZHRocyA9IG1lLmNvbHVtbldpZHRocztcclxuICB2YXIgbGVnZW5kV2lkdGggPSBtZS53aWR0aDtcclxuICB2YXIgbGluZVdpZHRocyA9IG1lLmxpbmVXaWR0aHM7XHJcbiAgdmFyIGxpbmVIZWlnaHRzID0gbWUubGluZUhlaWdodHM7XHJcblxyXG4gIGlmIChvcHRzLmRpc3BsYXkpIHtcclxuICAgIHZhciBjdHggPSBtZS5jdHg7XHJcbiAgICB2YXIgZm9udENvbG9yID0gdmFsdWVPckRlZmF1bHQobGFiZWxPcHRzLmZvbnRDb2xvciwgZ2xvYmFsRGVmYXVsdHMuZGVmYXVsdEZvbnRDb2xvcik7XHJcbiAgICB2YXIgbGFiZWxGb250ID0gaGVscGVycy5vcHRpb25zLl9wYXJzZUZvbnQobGFiZWxPcHRzKTtcclxuICAgIHZhciBmb250U2l6ZSA9IGxhYmVsRm9udC5zaXplO1xyXG4gICAgdmFyIGN1cnNvcjtcclxuXHJcbiAgICAvLyBDYW52YXMgc2V0dXBcclxuICAgIGN0eC50ZXh0QWxpZ24gPSAnbGVmdCc7XHJcbiAgICBjdHgudGV4dEJhc2VsaW5lID0gJ21pZGRsZSc7XHJcbiAgICBjdHgubGluZVdpZHRoID0gMC41O1xyXG4gICAgY3R4LnN0cm9rZVN0eWxlID0gZm9udENvbG9yOyAvLyBmb3Igc3RyaWtldGhyb3VnaCBlZmZlY3RcclxuICAgIGN0eC5maWxsU3R5bGUgPSBmb250Q29sb3I7IC8vIHJlbmRlciBpbiBjb3JyZWN0IGNvbG91clxyXG4gICAgY3R4LmZvbnQgPSBsYWJlbEZvbnQuc3RyaW5nO1xyXG5cclxuICAgIHZhciBib3hXaWR0aCA9IGdldEJveFdpZHRoKGxhYmVsT3B0cywgZm9udFNpemUpO1xyXG4gICAgdmFyIGhpdGJveGVzID0gbWUubGVnZW5kSGl0Qm94ZXM7XHJcblxyXG4gICAgLy8gY3VycmVudCBwb3NpdGlvblxyXG4gICAgdmFyIGRyYXdMZWdlbmRCb3ggPSBmdW5jdGlvbiAoeCwgeSwgbGVnZW5kSXRlbSkge1xyXG4gICAgICBpZiAoaXNOYU4oYm94V2lkdGgpIHx8IGJveFdpZHRoIDw9IDApIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIFNldCB0aGUgY3R4IGZvciB0aGUgYm94XHJcbiAgICAgIGN0eC5zYXZlKCk7XHJcblxyXG4gICAgICB2YXIgbGluZVdpZHRoID0gdmFsdWVPckRlZmF1bHQobGVnZW5kSXRlbS5saW5lV2lkdGgsIGxpbmVEZWZhdWx0LmJvcmRlcldpZHRoKTtcclxuICAgICAgY3R4LmZpbGxTdHlsZSA9IHZhbHVlT3JEZWZhdWx0KGxlZ2VuZEl0ZW0uZmlsbFN0eWxlLCBkZWZhdWx0Q29sb3IpO1xyXG4gICAgICBjdHgubGluZUNhcCA9IHZhbHVlT3JEZWZhdWx0KGxlZ2VuZEl0ZW0ubGluZUNhcCwgbGluZURlZmF1bHQuYm9yZGVyQ2FwU3R5bGUpO1xyXG4gICAgICBjdHgubGluZURhc2hPZmZzZXQgPSB2YWx1ZU9yRGVmYXVsdChsZWdlbmRJdGVtLmxpbmVEYXNoT2Zmc2V0LCBsaW5lRGVmYXVsdC5ib3JkZXJEYXNoT2Zmc2V0KTtcclxuICAgICAgY3R4LmxpbmVKb2luID0gdmFsdWVPckRlZmF1bHQobGVnZW5kSXRlbS5saW5lSm9pbiwgbGluZURlZmF1bHQuYm9yZGVySm9pblN0eWxlKTtcclxuICAgICAgY3R4LmxpbmVXaWR0aCA9IGxpbmVXaWR0aDtcclxuICAgICAgY3R4LnN0cm9rZVN0eWxlID0gdmFsdWVPckRlZmF1bHQobGVnZW5kSXRlbS5zdHJva2VTdHlsZSwgZGVmYXVsdENvbG9yKTtcclxuXHJcbiAgICAgIGlmIChjdHguc2V0TGluZURhc2gpIHtcclxuICAgICAgICAvLyBJRSA5IGFuZCAxMCBkbyBub3Qgc3VwcG9ydCBsaW5lIGRhc2hcclxuICAgICAgICBjdHguc2V0TGluZURhc2godmFsdWVPckRlZmF1bHQobGVnZW5kSXRlbS5saW5lRGFzaCwgbGluZURlZmF1bHQuYm9yZGVyRGFzaCkpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAob3B0cy5sYWJlbHMgJiYgb3B0cy5sYWJlbHMudXNlUG9pbnRTdHlsZSkge1xyXG4gICAgICAgIC8vIFJlY2FsY3VsYXRlIHggYW5kIHkgZm9yIGRyYXdQb2ludCgpIGJlY2F1c2UgaXRzIGV4cGVjdGluZ1xyXG4gICAgICAgIC8vIHggYW5kIHkgdG8gYmUgY2VudGVyIG9mIGZpZ3VyZSAoaW5zdGVhZCBvZiB0b3AgbGVmdClcclxuICAgICAgICB2YXIgcmFkaXVzID0gYm94V2lkdGggKiBNYXRoLlNRUlQyIC8gMjtcclxuICAgICAgICB2YXIgY2VudGVyWCA9IHggKyBib3hXaWR0aCAvIDI7XHJcbiAgICAgICAgdmFyIGNlbnRlclkgPSB5ICsgZm9udFNpemUgLyAyO1xyXG5cclxuICAgICAgICAvLyBEcmF3IHBvaW50U3R5bGUgYXMgbGVnZW5kIHN5bWJvbFxyXG4gICAgICAgIGhlbHBlcnMuY2FudmFzLmRyYXdQb2ludChjdHgsIGxlZ2VuZEl0ZW0ucG9pbnRTdHlsZSwgcmFkaXVzLCBjZW50ZXJYLCBjZW50ZXJZKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBEcmF3IGJveCBhcyBsZWdlbmQgc3ltYm9sXHJcbiAgICAgICAgaWYgKGxpbmVXaWR0aCAhPT0gMCkge1xyXG4gICAgICAgICAgY3R4LnN0cm9rZVJlY3QoeCwgeSwgYm94V2lkdGgsIGZvbnRTaXplKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY3R4LmZpbGxSZWN0KHgsIHksIGJveFdpZHRoLCBmb250U2l6ZSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGN0eC5yZXN0b3JlKCk7XHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBkcmF3U3RyaWtlVGhyb3VnaCA9IGZ1bmN0aW9uICh4LCB5LCB3KSB7XHJcbiAgICAgIGN0eC5iZWdpblBhdGgoKTtcclxuICAgICAgY3R4LmxpbmVXaWR0aCA9IDI7XHJcbiAgICAgIGN0eC5tb3ZlVG8oeCwgeSk7XHJcbiAgICAgIGN0eC5saW5lVG8oeCArIHcsIHkpO1xyXG4gICAgICBjdHguc3Ryb2tlKCk7XHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBkcmF3Q3Jvc3NPdmVyID0gZnVuY3Rpb24gKHgsIHksIHcsIGgpIHtcclxuICAgICAgY3R4LmJlZ2luUGF0aCgpO1xyXG4gICAgICBjdHgubGluZVdpZHRoID0gMjtcclxuICAgICAgY3R4Lm1vdmVUbyh4LCB5KTtcclxuICAgICAgY3R4LmxpbmVUbyh4ICsgdywgeSArIGgpO1xyXG4gICAgICBjdHgubW92ZVRvKHgsIHkgKyBoKTtcclxuICAgICAgY3R4LmxpbmVUbyh4ICsgdywgeSk7XHJcbiAgICAgIGN0eC5zdHJva2UoKTtcclxuICAgIH07XHJcblxyXG4gICAgdmFyIGZpbGxUZXh0ID0gZnVuY3Rpb24gKHgsIHksIGxlZ2VuZEl0ZW0sIHRleHRXaWR0aCkge1xyXG4gICAgICB2YXIgaGFsZkZvbnRTaXplID0gZm9udFNpemUgLyAyO1xyXG4gICAgICB2YXIgeExlZnQgPSBib3hXaWR0aCArIGhhbGZGb250U2l6ZSArIHg7XHJcbiAgICAgIHZhciB5TWlkZGxlID0geSArIGhhbGZGb250U2l6ZTtcclxuXHJcbiAgICAgIGlmIChoZWxwZXJzLmlzQXJyYXkobGVnZW5kSXRlbS50ZXh0KSkge1xyXG4gICAgICAgIGhlbHBlcnMuZWFjaChsZWdlbmRJdGVtLnRleHQsIGZ1bmN0aW9uICh0ZXh0TGluZSwgaW5kZXgpIHtcclxuICAgICAgICAgIHZhciBsaW5lT2Zmc2V0ID0gaW5kZXggKiBmb250U2l6ZTtcclxuICAgICAgICAgIGN0eC5maWxsVGV4dCh0ZXh0TGluZSwgeExlZnQsIHlNaWRkbGUgKyBsaW5lT2Zmc2V0KTtcclxuICAgICAgICB9KTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjdHguZmlsbFRleHQobGVnZW5kSXRlbS50ZXh0LCB4TGVmdCwgeU1pZGRsZSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChsZWdlbmRJdGVtLmhpZGRlbikge1xyXG4gICAgICAgIGlmIChoZWxwZXJzLmlzQXJyYXkobGVnZW5kSXRlbS50ZXh0KSkge1xyXG4gICAgICAgICAgZHJhd0Nyb3NzT3Zlcih4TGVmdCwgeU1pZGRsZSwgdGV4dFdpZHRoLCAobGVnZW5kSXRlbS50ZXh0Lmxlbmd0aCAtIDEpICogKGZvbnRTaXplIC0gMSkpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBkcmF3U3RyaWtlVGhyb3VnaCh4TGVmdCwgeU1pZGRsZSwgdGV4dFdpZHRoKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgdmFyIGFsaWdubWVudE9mZnNldCA9IGZ1bmN0aW9uIChkaW1lbnNpb24sIGJsb2NrU2l6ZSkge1xyXG4gICAgICBzd2l0Y2ggKG9wdHMuYWxpZ24pIHtcclxuICAgICAgICBjYXNlICdzdGFydCc6XHJcbiAgICAgICAgICByZXR1cm4gbGFiZWxPcHRzLnBhZGRpbmc7XHJcbiAgICAgICAgY2FzZSAnZW5kJzpcclxuICAgICAgICAgIHJldHVybiBkaW1lbnNpb24gLSBibG9ja1NpemU7XHJcbiAgICAgICAgZGVmYXVsdDogLy8gY2VudGVyXHJcbiAgICAgICAgICByZXR1cm4gKGRpbWVuc2lvbiAtIGJsb2NrU2l6ZSArIGxhYmVsT3B0cy5wYWRkaW5nKSAvIDI7XHJcbiAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgLy8gSG9yaXpvbnRhbFxyXG4gICAgdmFyIGlzSG9yaXpvbnRhbCA9IG1lLmlzSG9yaXpvbnRhbCgpO1xyXG4gICAgaWYgKGlzSG9yaXpvbnRhbCkge1xyXG4gICAgICBjdXJzb3IgPSB7XHJcbiAgICAgICAgeDogbWUubGVmdCArIGFsaWdubWVudE9mZnNldChsZWdlbmRXaWR0aCwgbGluZVdpZHRoc1swXSksXHJcbiAgICAgICAgeTogbWUudG9wICsgbGFiZWxPcHRzLnBhZGRpbmcsXHJcbiAgICAgICAgbGluZTogMFxyXG4gICAgICB9O1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY3Vyc29yID0ge1xyXG4gICAgICAgIHg6IG1lLmxlZnQgKyBsYWJlbE9wdHMucGFkZGluZyxcclxuICAgICAgICB5OiBtZS50b3AgKyBhbGlnbm1lbnRPZmZzZXQobGVnZW5kSGVpZ2h0LCBjb2x1bW5IZWlnaHRzWzBdKSxcclxuICAgICAgICBsaW5lOiAwXHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgaGVscGVycy5lYWNoKG1lLmxlZ2VuZEl0ZW1zLCBmdW5jdGlvbiAobGVnZW5kSXRlbSwgaSkge1xyXG4gICAgICB2YXIgdGV4dFdpZHRoLCBoZWlnaHQsIGJveFRvcE9mZnNldDtcclxuXHJcbiAgICAgIGlmIChsZWdlbmRJdGVtLmxpbmVPckNvbHVtbkluZGV4ID4gY3Vyc29yLmxpbmUpIHtcclxuICAgICAgICBpZiAoaXNIb3Jpem9udGFsKSB7XHJcbiAgICAgICAgICBjdXJzb3IueSArPSBsaW5lSGVpZ2h0c1tjdXJzb3IubGluZV07XHJcbiAgICAgICAgICBjdXJzb3IubGluZSA9IGxlZ2VuZEl0ZW0ubGluZU9yQ29sdW1uSW5kZXg7XHJcbiAgICAgICAgICBjdXJzb3IueCA9IG1lLmxlZnQgKyBhbGlnbm1lbnRPZmZzZXQobGVnZW5kV2lkdGgsIGxpbmVXaWR0aHNbY3Vyc29yLmxpbmVdKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgY3Vyc29yLnggKz0gY29sdW1uV2lkdGhzW2N1cnNvci5saW5lXSArIGxhYmVsT3B0cy5wYWRkaW5nO1xyXG4gICAgICAgICAgY3Vyc29yLmxpbmUgPSBsZWdlbmRJdGVtLmxpbmVPckNvbHVtbkluZGV4O1xyXG4gICAgICAgICAgY3Vyc29yLnkgPSBtZS50b3AgKyBhbGlnbm1lbnRPZmZzZXQobGVnZW5kSGVpZ2h0LCBjb2x1bW5IZWlnaHRzW2N1cnNvci5saW5lXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoaGVscGVycy5pc0FycmF5KGxlZ2VuZEl0ZW0udGV4dCkpIHtcclxuICAgICAgICB0ZXh0V2lkdGggPSBsZWdlbmRJdGVtLnRleHQubWFwKGZ1bmN0aW9uICh0ZXh0TGluZSkge1xyXG4gICAgICAgICAgcmV0dXJuIGN0eC5tZWFzdXJlVGV4dCh0ZXh0TGluZSkud2lkdGg7XHJcbiAgICAgICAgfSkucmVkdWNlKGZ1bmN0aW9uIChhY2MsIHYpIHtcclxuICAgICAgICAgIHJldHVybiB2ID4gYWNjID8gdiA6IGFjYztcclxuICAgICAgICB9LCAwKTtcclxuICAgICAgICBib3hUb3BPZmZzZXQgPSBmb250U2l6ZSAvIDIgKiAobGVnZW5kSXRlbS50ZXh0Lmxlbmd0aCAtIDEpO1xyXG4gICAgICAgIGhlaWdodCA9IGZvbnRTaXplICogbGVnZW5kSXRlbS50ZXh0Lmxlbmd0aDtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0ZXh0V2lkdGggPSBjdHgubWVhc3VyZVRleHQobGVnZW5kSXRlbS50ZXh0KS53aWR0aDtcclxuICAgICAgICBib3hUb3BPZmZzZXQgPSAwO1xyXG4gICAgICAgIGhlaWdodCA9IGZvbnRTaXplO1xyXG4gICAgICB9XHJcblxyXG4gICAgICB2YXIgd2lkdGggPSBib3hXaWR0aCArIChmb250U2l6ZSAvIDIpICsgdGV4dFdpZHRoO1xyXG4gICAgICB2YXIgeCA9IGN1cnNvci54O1xyXG4gICAgICB2YXIgeSA9IGN1cnNvci55O1xyXG5cclxuICAgICAgdmFyIHRvcE9mZnNldCA9IGlzSG9yaXpvbnRhbCA/IE1hdGgudHJ1bmMoKGxpbmVIZWlnaHRzW2N1cnNvci5saW5lXSAtIGhpdGJveGVzW2ldLmhlaWdodCkgLyAyKSA6IDA7XHJcblxyXG4gICAgICBkcmF3TGVnZW5kQm94KHgsIHkgKyBib3hUb3BPZmZzZXQgKyB0b3BPZmZzZXQsIGxlZ2VuZEl0ZW0pO1xyXG5cclxuICAgICAgaGl0Ym94ZXNbaV0ubGVmdCA9IHg7XHJcbiAgICAgIGhpdGJveGVzW2ldLnRvcCA9IHk7XHJcblxyXG4gICAgICAvLyBGaWxsIHRoZSBhY3R1YWwgbGFiZWxcclxuICAgICAgZmlsbFRleHQoeCwgeSArIHRvcE9mZnNldCwgbGVnZW5kSXRlbSwgdGV4dFdpZHRoKTtcclxuXHJcbiAgICAgIGlmIChpc0hvcml6b250YWwpIHtcclxuICAgICAgICBjdXJzb3IueCArPSB3aWR0aCArIGxhYmVsT3B0cy5wYWRkaW5nO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGN1cnNvci55ICs9IGhlaWdodCArIGxhYmVsT3B0cy5wYWRkaW5nO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBtb25rZXlQYXRjaENoYXJ0SnNMZWdlbmQoKSB7XHJcbiAgY29uc3QgcGx1Z2lucyA9IENoYXJ0LnBsdWdpbnMuZ2V0QWxsKCk7XHJcbiAgY29uc3QgbGVnZW5kID0gcGx1Z2lucy5maWx0ZXIocCA9PiBwLmlkID09PSAnbGVnZW5kJylbMF07XHJcbiAgbGVnZW5kLl9lbGVtZW50LnByb3RvdHlwZS5maXQgPSBmaXQ7XHJcbiAgbGVnZW5kLl9lbGVtZW50LnByb3RvdHlwZS5kcmF3ID0gZHJhdztcclxufVxyXG4iXX0=